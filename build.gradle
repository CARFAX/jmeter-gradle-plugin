apply plugin: 'groovy'
apply plugin: 'idea'
apply plugin: 'maven'

group = 'org.veil.gradle.plugins'
archivesBaseName = 'jmeter-gradle-plugin'
/**
 * Currently support JMeter version 2.6, 2.7, 2.8, 2.9
 */
ext.jmeterVersion = "2.9"
version = "1.3.1-$jmeterVersion-SNAPSHOT"



sourceCompatibility=1.6
targetCompatibility=1.6

repositories {
    maven {
        url "http://repo.kulya.info/content/groups/public/"
    }
}

dependencies {
	compile gradleApi(),
        "org.apache.ant:ant:1.8.4",
        "org.apache.jmeter:ApacheJMeter_http:${jmeterVersion}",
		"org.apache.jmeter:ApacheJMeter_junit:${jmeterVersion}",
        "org.apache.jmeter:ApacheJMeter_java:${jmeterVersion}",
        "org.apache.jmeter:ApacheJMeter_report:${jmeterVersion}",
        "org.apache.jmeter:ApacheJMeter_jdbc:${jmeterVersion}",
        "org.apache.jmeter:ApacheJMeter_tcp:${jmeterVersion}",
        "org.apache.jmeter:ApacheJMeter_mail:${jmeterVersion}",
        "org.apache.jmeter:ApacheJMeter_ldap:${jmeterVersion}",
        "org.apache.jmeter:ApacheJMeter_ftp:${jmeterVersion}",
        "org.apache.jmeter:ApacheJMeter_functions:${jmeterVersion}",
        "org.apache.jmeter:ApacheJMeter_monitors:${jmeterVersion}",
        "org.apache.jmeter:ApacheJMeter_jms:${jmeterVersion}",
        "org.apache.jmeter:ApacheJMeter:${jmeterVersion}",
        "org.beanshell:bsh-core:2.0b4"
    if (jmeterVersion > '2.7') {
        compile "org.apache.jmeter:ApacheJMeter_native:${jmeterVersion}"
    }
	
	groovy localGroovy()
	
	testCompile "junit:junit:4.11"
}

task sourceJar(type: Jar) {
    classifier = 'sources'
    from sourceSets.main.java
}

artifacts {
    archives sourceJar
}

processResources.doLast {
    ant.replace(
            file: "${project.buildDir}/resources/main/jmeter-plugin.properties",
            token: "@jmeter.version@",
            value: "$jmeterVersion"
    )
}

uploadArchives {
    repositories {
        mavenDeployer {
            repository(url: "http://repo.kulya.info/content/repositories/releases/") {
                authentication(userName: kulyaMvnDeployerUser, password: kulyaMvnDeployerPass)
            }

            snapshotRepository(url: "http://repo.kulya.info/content/repositories/snapshots/") {
                authentication(userName: kulyaMvnDeployerUser, password: kulyaMvnDeployerPass)
            }
        }
    }
}

